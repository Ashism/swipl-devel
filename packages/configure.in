#!/bin/sh

# This  program  is  used  to  build    the  SWI-Prolog  packages.  Both
# configure.in  and  Makefile.in  receive  info  from  the  main  Prolog
# configure run.   Typically the packages are build using
#
#	./configure
#	make
#	make install
#
# If  you  also  plan  to  share  the  packages  for  both  single-  and
# multi-threaded SWI-Prolog they must be built for multi-threading.

MAKE=@MAKE@
export MAKE

findexe()
{ oldifs="$IFS"
  IFS=:
  for d in $PATH; do
    if [ -x $d/$1 ]; then
       IFS="$oldifs"
       return 0
    fi
  done
  IFS="$oldifs"
  return 1
}

if [ -z "$PKG" ]; then
  PKG="clib cpp odbc table sgml sgml/RDF semweb http chr xpce"
fi

if findexe javac; then
  PKG="$PKG jpl"
fi

configoptions=""

while [ "$1" != "" ]; do
  case "$1" in
	--without-jpl)	PKG="`echo $PKG | sed 's/\<jpl\>//'`"
			shift
			;;
  *)			configoptions="$configoptions $1"
			shift
			;;
  esac
done

sed "s@^PKG=.*@PKG=$PKG@" Makefile > Makefile.pkg
if cmp -s Makefile Makefile.pkg; then
   rm Makefile
else
   mv Makefile.pkg Makefile
fi

$MAKE CNFGPASSED="$configoptions" configure
